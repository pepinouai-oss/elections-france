<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>R√©sultats √âlectoraux - France</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen p-6">
    <div class="max-w-6xl mx-auto">
        <div class="bg-white rounded-2xl shadow-2xl p-8">
            <div class="mb-8">
                <h1 class="text-4xl font-bold text-gray-800 mb-2 flex items-center gap-3">
                    üìä R√©sultats √âlectoraux - France
                </h1>
                <p class="text-gray-600">Explorez les r√©sultats √©lectoraux depuis 2000</p>
            </div>

            <!-- Filtres -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Type d'√©lection</label>
                    <select id="typeElection" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none">
                        <option value="legislatives">√âlections L√©gislatives</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">üìç Commune</label>
                    <input type="text" id="commune" value="Monistrol-sur-Loire" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none">
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">üìÖ Ann√©e</label>
                    <select id="annee" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none">
                        <option value="2024">2024</option>
                        <option value="2022">2022</option>
                        <option value="2017">2017</option>
                        <option value="2012">2012</option>
                        <option value="2007">2007</option>
                        <option value="2002">2002</option>
                    </select>
                </div>
            </div>

            <!-- S√©lection du tour -->
            <div id="toursButtons" class="flex gap-4 mb-6"></div>

            <!-- Informations sur le tour -->
            <div id="tourInfo" class="bg-indigo-50 rounded-xl p-6 mb-6"></div>

            <!-- Graphique -->
            <div class="mb-8">
                <h3 class="text-xl font-bold text-gray-800 mb-4">R√©sultats par candidat</h3>
                <canvas id="resultsChart" height="100"></canvas>
            </div>

            <!-- Tableau des r√©sultats -->
            <div class="overflow-x-auto">
                <h3 class="text-xl font-bold text-gray-800 mb-4">D√©tail des r√©sultats</h3>
                <table id="resultsTable" class="w-full">
                    <thead>
                        <tr class="bg-gray-100">
                            <th class="text-left p-3 font-semibold">Candidat</th>
                            <th class="text-left p-3 font-semibold">Parti</th>
                            <th class="text-right p-3 font-semibold">Voix</th>
                            <th class="text-right p-3 font-semibold">%</th>
                            <th class="text-center p-3 font-semibold">Statut</th>
                        </tr>
                    </thead>
                    <tbody id="resultsTableBody"></tbody>
                </table>
            </div>

            <!-- Message informatif -->
            <div class="mt-8 bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded">
                <p class="text-sm text-yellow-800">
                    <strong>Note :</strong> Donn√©es de d√©monstration pour Monistrol-sur-Loire (1√®re circonscription de Haute-Loire). 
                    Pour utiliser des donn√©es r√©elles, t√©l√©chargez les fichiers CSV depuis 
                    <a href="https://www.data.gouv.fr" target="_blank" class="underline font-semibold">data.gouv.fr</a>.
                </p>
            </div>
        </div>
    </div>

    <script>
        // Donn√©es de d√©monstration
        const demoData = {
            "legislatives": {
                "2024": {
                    tours: [
                        {
                            tour: "1er tour",
                            date: "30 juin 2024",
                            candidats: [
                                { nom: "Jean DUPONT", parti: "Ensemble", voix: 3420, pourcentage: 28.5 },
                                { nom: "Marie MARTIN", parti: "RN", voix: 3180, pourcentage: 26.5 },
                                { nom: "Pierre DURAND", parti: "NFP", voix: 2850, pourcentage: 23.8 },
                                { nom: "Sophie BERNARD", parti: "LR", voix: 2550, pourcentage: 21.2 }
                            ],
                            inscrits: 15800,
                            votants: 12000,
                            exprimes: 12000,
                            participation: 75.9
                        },
                        {
                            tour: "2√®me tour",
                            date: "7 juillet 2024",
                            candidats: [
                                { nom: "Jean DUPONT", parti: "Ensemble", voix: 5850, pourcentage: 51.2, elu: true },
                                { nom: "Marie MARTIN", parti: "RN", voix: 5580, pourcentage: 48.8 }
                            ],
                            inscrits: 15800,
                            votants: 11430,
                            exprimes: 11430,
                            participation: 72.3
                        }
                    ]
                },
                "2022": {
                    tours: [
                        {
                            tour: "1er tour",
                            date: "12 juin 2022",
                            candidats: [
                                { nom: "Isabelle VALENTIN", parti: "LR", voix: 3680, pourcentage: 32.1 },
                                { nom: "Laurent WAUQUIEZ", parti: "Divers Droite", voix: 2950, pourcentage: 25.8 },
                                { nom: "Claire LEFORT", parti: "NUPES", voix: 2580, pourcentage: 22.5 },
                                { nom: "Marc PETIT", parti: "RN", voix: 2240, pourcentage: 19.6 }
                            ],
                            inscrits: 15650,
                            votants: 11450,
                            exprimes: 11450,
                            participation: 73.2
                        },
                        {
                            tour: "2√®me tour",
                            date: "19 juin 2022",
                            candidats: [
                                { nom: "Isabelle VALENTIN", parti: "LR", voix: 6420, pourcentage: 58.3, elu: true },
                                { nom: "Claire LEFORT", parti: "NUPES", voix: 4590, pourcentage: 41.7 }
                            ],
                            inscrits: 15650,
                            votants: 11010,
                            exprimes: 11010,
                            participation: 70.3
                        }
                    ]
                },
                "2017": {
                    tours: [
                        {
                            tour: "1er tour",
                            date: "11 juin 2017",
                            candidats: [
                                { nom: "Isabelle VALENTIN", parti: "LR", voix: 4250, pourcentage: 38.5 },
                                { nom: "Jean-Paul VERGER", parti: "FN", voix: 2680, pourcentage: 24.3 },
                                { nom: "Anne BRUGNERA", parti: "LREM", voix: 2150, pourcentage: 19.5 },
                                { nom: "Michel CHAPUIS", parti: "PS", voix: 1950, pourcentage: 17.7 }
                            ],
                            inscrits: 15420,
                            votants: 11030,
                            exprimes: 11030,
                            participation: 71.5
                        },
                        {
                            tour: "2√®me tour",
                            date: "18 juin 2017",
                            candidats: [
                                { nom: "Isabelle VALENTIN", parti: "LR", voix: 6850, pourcentage: 65.8, elu: true },
                                { nom: "Jean-Paul VERGER", parti: "FN", voix: 3560, pourcentage: 34.2 }
                            ],
                            inscrits: 15420,
                            votants: 10410,
                            exprimes: 10410,
                            participation: 67.5
                        }
                    ]
                },
                "2012": {
                    tours: [
                        {
                            tour: "1er tour",
                            date: "10 juin 2012",
                            candidats: [
                                { nom: "Laurent WAUQUIEZ", parti: "UMP", voix: 5420, pourcentage: 48.2 },
                                { nom: "Philippe VIAL", parti: "PS", voix: 3250, pourcentage: 28.9 },
                                { nom: "Marie DUBOIS", parti: "FN", voix: 1580, pourcentage: 14.1 },
                                { nom: "Pierre CHARVET", parti: "Front de Gauche", voix: 980, pourcentage: 8.8 }
                            ],
                            inscrits: 15180,
                            votants: 11230,
                            exprimes: 11230,
                            participation: 74.0
                        },
                        {
                            tour: "2√®me tour",
                            date: "17 juin 2012",
                            candidats: [
                                { nom: "Laurent WAUQUIEZ", parti: "UMP", voix: 7380, pourcentage: 68.5, elu: true },
                                { nom: "Philippe VIAL", parti: "PS", voix: 3390, pourcentage: 31.5 }
                            ],
                            inscrits: 15180,
                            votants: 10770,
                            exprimes: 10770,
                            participation: 70.9
                        }
                    ]
                },
                "2007": {
                    tours: [
                        {
                            tour: "1er tour",
                            date: "10 juin 2007",
                            candidats: [
                                { nom: "Laurent WAUQUIEZ", parti: "UMP", voix: 5850, pourcentage: 52.8 },
                                { nom: "Jean MALLEVAL", parti: "PS", voix: 3180, pourcentage: 28.7 },
                                { nom: "Andr√© CHASSAIGNE", parti: "PCF", voix: 1250, pourcentage: 11.3 },
                                { nom: "Marie FAURE", parti: "Divers Gauche", voix: 800, pourcentage: 7.2 }
                            ],
                            inscrits: 14980,
                            votants: 11080,
                            exprimes: 11080,
                            participation: 74.0
                        },
                        {
                            tour: "2√®me tour",
                            date: "17 juin 2007",
                            candidats: [
                                { nom: "Laurent WAUQUIEZ", parti: "UMP", voix: 7650, pourcentage: 71.2, elu: true },
                                { nom: "Jean MALLEVAL", parti: "PS", voix: 3095, pourcentage: 28.8 }
                            ],
                            inscrits: 14980,
                            votants: 10745,
                            exprimes: 10745,
                            participation: 71.7
                        }
                    ]
                },
                "2002": {
                    tours: [
                        {
                            tour: "1er tour",
                            date: "9 juin 2002",
                            candidats: [
                                { nom: "Laurent WAUQUIEZ", parti: "UMP", voix: 4850, pourcentage: 45.2 },
                                { nom: "Bernard LECHERBONNIER", parti: "PS", voix: 3420, pourcentage: 31.9 },
                                { nom: "Claude MARTIN", parti: "FN", voix: 1580, pourcentage: 14.7 },
                                { nom: "Pierre VIDAL", parti: "PCF", voix: 880, pourcentage: 8.2 }
                            ],
                            inscrits: 14720,
                            votants: 10730,
                            exprimes: 10730,
                            participation: 72.9
                        },
                        {
                            tour: "2√®me tour",
                            date: "16 juin 2002",
                            candidats: [
                                { nom: "Laurent WAUQUIEZ", parti: "UMP", voix: 6980, pourcentage: 67.8, elu: true },
                                { nom: "Bernard LECHERBONNIER", parti: "PS", voix: 3320, pourcentage: 32.2 }
                            ],
                            inscrits: 14720,
                            votants: 10300,
                            exprimes: 10300,
                            participation: 70.0
                        }
                    ]
                }
            }
        };

        const partyColors = {
            'RN': '#0d378a',
            'FN': '#0d378a',
            'Ensemble': '#ffeb3b',
            'LREM': '#ffeb3b',
            'LR': '#0066cc',
            'UMP': '#0066cc',
            'NFP': '#ff4444',
            'NUPES': '#ff4444',
            'PS': '#ff8fab',
            'PCF': '#dd0000',
            'Front de Gauche': '#dd0000',
            'Divers Droite': '#6699cc',
            'Divers Gauche': '#ffaacc'
        };

        let currentTour = 0;
        let chart = null;

        function getColorByParti(parti) {
            return partyColors[parti] || '#888888';
        }

        function updateDisplay() {
            const typeElection = document.getElementById('typeElection').value;
            const annee = document.getElementById('annee').value;
            
            const resultatsAnnee = demoData[typeElection][annee];
            if (!resultatsAnnee) return;

            // Mettre √† jour les boutons de tour
            const toursButtons = document.getElementById('toursButtons');
            toursButtons.innerHTML = '';
            resultatsAnnee.tours.forEach((tour, index) => {
                const button = document.createElement('button');
                button.textContent = tour.tour;
                button.className = `px-6 py-3 rounded-lg font-semibold transition-all ${
                    currentTour === index
                        ? 'bg-indigo-600 text-white shadow-lg'
                        : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                }`;
                button.onclick = () => {
                    currentTour = index;
                    updateDisplay();
                };
                toursButtons.appendChild(button);
            });

            const tourActuel = resultatsAnnee.tours[currentTour];

            // Mettre √† jour les infos du tour
            document.getElementById('tourInfo').innerHTML = `
                <h2 class="text-2xl font-bold text-indigo-900 mb-4">${tourActuel.tour} - ${tourActuel.date}</h2>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div class="bg-white rounded-lg p-4">
                        <p class="text-sm text-gray-600">Inscrits</p>
                        <p class="text-2xl font-bold text-gray-800">${tourActuel.inscrits.toLocaleString()}</p>
                    </div>
                    <div class="bg-white rounded-lg p-4">
                        <p class="text-sm text-gray-600">Votants</p>
                        <p class="text-2xl font-bold text-gray-800">${tourActuel.votants.toLocaleString()}</p>
                    </div>
                    <div class="bg-white rounded-lg p-4">
                        <p class="text-sm text-gray-600">Exprim√©s</p>
                        <p class="text-2xl font-bold text-gray-800">${tourActuel.exprimes.toLocaleString()}</p>
                    </div>
                    <div class="bg-white rounded-lg p-4">
                        <p class="text-sm text-gray-600">Participation</p>
                        <p class="text-2xl font-bold text-indigo-600">${tourActuel.participation}%</p>
                    </div>
                </div>
            `;

            // Mettre √† jour le graphique
            updateChart(tourActuel);

            // Mettre √† jour le tableau
            const tbody = document.getElementById('resultsTableBody');
            tbody.innerHTML = '';
            tourActuel.candidats.forEach(candidat => {
                const row = tbody.insertRow();
                row.className = 'border-b hover:bg-gray-50';
                row.innerHTML = `
                    <td class="p-3 font-medium">${candidat.nom}</td>
                    <td class="p-3">
                        <span class="px-3 py-1 rounded-full text-white text-sm font-semibold" style="background-color: ${getColorByParti(candidat.parti)}">
                            ${candidat.parti}
                        </span>
                    </td>
                    <td class="p-3 text-right font-medium">${candidat.voix.toLocaleString()}</td>
                    <td class="p-3 text-right font-bold">${candidat.pourcentage}%</td>
                    <td class="p-3 text-center">
                        ${candidat.elu ? '<span class="bg-green-500 text-white px-3 py-1 rounded-full text-sm font-bold">√âLU</span>' : ''}
                    </td>
                `;
            });
        }

        function updateChart(tourActuel) {
            const ctx = document.getElementById('resultsChart').getContext('2d');
            
            if (chart) {
                chart.destroy();
            }

            chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: tourActuel.candidats.map(c => c.nom.split(' ')[1] || c.nom),
                    datasets: [{
                        label: 'Voix',
                        data: tourActuel.candidats.map(c => c.voix),
                        backgroundColor: tourActuel.candidats.map(c => getColorByParti(c.parti)),
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const candidat = tourActuel.candidats[context.dataIndex];
                                    return `${candidat.voix.toLocaleString()} voix (${candidat.pourcentage}%)`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }

        // Event listeners
        document.getElementById('typeElection').addEventListener('change', () => {
            currentTour = 0;
            updateDisplay();
        });
        document.getElementById('annee').addEventListener('change', () => {
            currentTour = 0;
            updateDisplay();
        });

        // Initialisation
        updateDisplay();
    </script>
</body>
</html>
